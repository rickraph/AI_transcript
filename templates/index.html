<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oliveboard Transcriber â€” Audio to Timeline</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --ob-blue: #32B5E5;
            --ob-blue-dark: #2196C7;
            --ob-blue-deeper: #1A7BA3;
            --ob-blue-light: #5FC9ED;
            --ob-blue-pale: #E8F7FC;
            --ob-blue-glow: rgba(50, 181, 229, 0.25);
            --ob-charcoal: #1A1A2E;
            --ob-charcoal-light: #2D2D4E;
            --ob-red: #E53935;
            --bg: #F0F8FF;
            --surface: #FFFFFF;
            --border: #D6EEF8;
            --border-hover: #A8D8EE;
            --border-blue: rgba(50, 181, 229, 0.3);
            --text: #1E293B;
            --text-secondary: #475569;
            --text-muted: #94A3B8;
            --success: #10B981;
            --success-light: #D1FAE5;
            --success-glow: rgba(16, 185, 129, 0.15);
            --error: #EF4444;
            --error-light: #FEE2E2;
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --font: 'Plus Jakarta Sans', -apple-system, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            --shadow: 0 4px 16px rgba(0,0,0,0.06), 0 1px 3px rgba(0,0,0,0.04);
            --shadow-md: 0 8px 30px rgba(0,0,0,0.08);
            --shadow-blue: 0 4px 20px rgba(50,181,229,0.2), 0 1px 4px rgba(50,181,229,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ==================== ANIMATED BACKGROUND ==================== */
        .bg-canvas {
            position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden;
            background: linear-gradient(135deg, #F0F8FF 0%, #E8F4FB 40%, #EFF9FE 100%);
        }

        /* Floating orbs */
        .orb {
            position: absolute; border-radius: 50%;
            filter: blur(60px); animation: orbFloat linear infinite;
            will-change: transform;
        }
        .orb-1 { width: 700px; height: 700px; background: radial-gradient(circle, rgba(50,181,229,0.18) 0%, transparent 70%); top: -200px; right: -150px; animation-duration: 22s; }
        .orb-2 { width: 500px; height: 500px; background: radial-gradient(circle, rgba(95,201,237,0.14) 0%, transparent 70%); bottom: -100px; left: -100px; animation-duration: 30s; animation-direction: reverse; }
        .orb-3 { width: 350px; height: 350px; background: radial-gradient(circle, rgba(50,181,229,0.1) 0%, transparent 70%); top: 40%; left: 30%; animation-duration: 18s; animation-delay: -8s; }
        .orb-4 { width: 200px; height: 200px; background: radial-gradient(circle, rgba(26,123,163,0.12) 0%, transparent 70%); top: 20%; right: 20%; animation-duration: 14s; animation-delay: -4s; }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -40px) scale(1.04); }
            50% { transform: translate(-20px, 30px) scale(0.97); }
            75% { transform: translate(40px, 20px) scale(1.02); }
        }

        /* Wave Lines */
        .wave-lines {
            position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden;
        }
        .wave-lines svg { position: absolute; width: 100%; bottom: 0; opacity: 0.06; }

        /* Dot grid */
        .dot-grid {
            position: fixed; inset: 0; pointer-events: none; z-index: 0;
            background-image: radial-gradient(circle, rgba(50,181,229,0.5) 0.8px, transparent 0.8px);
            background-size: 32px 32px; opacity: 0.18;
            animation: gridShift 40s linear infinite;
        }
        @keyframes gridShift { 0% { background-position: 0 0; } 100% { background-position: 32px 32px; } }

        /* Floating particles */
        .particles { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
        .particle {
            position: absolute; border-radius: 50%;
            background: var(--ob-blue); opacity: 0;
            animation: particleRise linear infinite;
        }
        @keyframes particleRise {
            0% { opacity: 0; transform: translateY(0) scale(0); }
            10% { opacity: 0.6; }
            90% { opacity: 0.2; }
            100% { opacity: 0; transform: translateY(-120vh) scale(1.5); }
        }

        /* ==================== HEADER ==================== */
        header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(24px) saturate(1.6);
            border-bottom: 1px solid rgba(50,181,229,0.15);
            padding: 0 2rem;
            box-shadow: 0 4px 32px rgba(50,181,229,0.08);
            animation: slideDown 0.6s cubic-bezier(0.22,1,0.36,1);
        }
        @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .header-inner {
            max-width: 1100px; margin: 0 auto;
            display: flex; align-items: center; justify-content: space-between; height: 72px;
        }

        /* Logo with animation */
        .logo { display: flex; align-items: center; gap: 14px; text-decoration: none; }
        .logo-img-wrap {
            position: relative; display: flex; align-items: center;
        }
        .logo-img-wrap::before {
            content: ''; position: absolute; inset: -6px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(50,181,229,0.15), rgba(95,201,237,0.05));
            opacity: 0; transition: opacity 0.4s ease;
        }
        .logo:hover .logo-img-wrap::before { opacity: 1; }
        .logo img {
            height: 40px; width: auto; object-fit: contain;
            filter: drop-shadow(0 2px 12px rgba(50,181,229,0.25));
            transition: filter 0.4s ease, transform 0.4s cubic-bezier(0.22,1,0.36,1);
        }
        .logo:hover img {
            filter: drop-shadow(0 4px 20px rgba(50,181,229,0.5));
            transform: scale(1.04);
        }

        
            100% { opacity: 0; transform: translate(-50%,-50%) scale(1.8); }
        }

        .logo-divider { width: 1px; height: 30px; background: linear-gradient(to bottom, transparent, rgba(50,181,229,0.3), transparent); }
        .logo-text-wrap { display: flex; flex-direction: column; gap: 1px; }
        .logo-subtitle { font-size: 0.78rem; font-weight: 700; color: var(--ob-blue); letter-spacing: 0.04em; }
        .logo-tagline { font-size: 0.65rem; color: var(--text-muted); font-weight: 500; letter-spacing: 0.02em; }

        /* Nav tabs â€” animated pill */
        .nav-tabs {
            display: flex; gap: 4px; background: rgba(240,248,255,0.9);
            border-radius: 14px; padding: 5px; border: 1px solid var(--border);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.04), 0 2px 8px rgba(50,181,229,0.06);
            position: relative;
        }
        .nav-tab {
            padding: 10px 24px; font-size: 0.83rem; font-weight: 700;
            border-radius: 10px; cursor: pointer; color: var(--text-secondary);
            transition: all 0.35s cubic-bezier(0.22, 1, 0.36, 1);
            border: none; background: none; font-family: var(--font); white-space: nowrap;
            position: relative; z-index: 1;
        }
        .nav-tab:hover { color: var(--ob-blue); }
        .nav-tab.active { color: white; }
        .nav-tab.active::before {
            content: ''; position: absolute; inset: 0; border-radius: 10px;
            background: linear-gradient(135deg, var(--ob-blue) 0%, var(--ob-blue-dark) 100%);
            box-shadow: 0 4px 16px rgba(50,181,229,0.4), 0 1px 4px rgba(50,181,229,0.2);
            z-index: -1; animation: tabIn 0.35s cubic-bezier(0.22,1,0.36,1);
        }
        @keyframes tabIn { from { transform: scale(0.9); opacity: 0.5; } to { transform: scale(1); opacity: 1; } }

        /* Status bar below header */
        .status-bar {
            position: relative; z-index: 99;
            background: linear-gradient(90deg, var(--ob-blue), var(--ob-blue-light), var(--ob-blue));
            background-size: 200% 100%;
            animation: statusShimmer 4s linear infinite;
            height: 3px;
        }
        @keyframes statusShimmer { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }

        /* ==================== HERO BANNER ==================== */
        .hero-banner {
            position: relative; z-index: 1;
            background: linear-gradient(135deg, rgba(50,181,229,0.08) 0%, rgba(255,255,255,0.6) 50%, rgba(95,201,237,0.06) 100%);
            border-bottom: 1px solid rgba(50,181,229,0.12);
            padding: 2.5rem 2rem 2rem;
            overflow: hidden;
            margin-bottom: 0;
        }
        .hero-banner::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(50,181,229,0.04) 50%, transparent 100%);
            animation: heroPulse 5s ease-in-out infinite;
        }
        @keyframes heroPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .hero-inner {
            max-width: 1100px; margin: 0 auto; position: relative;
            display: flex; align-items: center; justify-content: space-between; gap: 2rem;
            flex-wrap: wrap;
        }
        .hero-text h1 {
            font-size: 2.4rem; font-weight: 800; letter-spacing: -0.05em;
            color: var(--ob-charcoal); line-height: 1.1; margin-bottom: 0.5rem;
        }
        .hero-text h1 .word-audio { color: var(--ob-blue); position: relative; display: inline-block; }
        .hero-text h1 .word-audio::after {
            content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--ob-blue), var(--ob-blue-light));
            border-radius: 2px; animation: underlineGrow 1.5s cubic-bezier(0.22,1,0.36,1) both;
        }
        @keyframes underlineGrow { from { transform: scaleX(0); } to { transform: scaleX(1); } }
        .hero-text p { color: var(--text-secondary); font-size: 0.92rem; line-height: 1.6; max-width: 440px; }

        /* Waveform animation in hero */
        .hero-wave {
            display: flex; align-items: center; gap: 3px; height: 48px;
        }
        .wave-bar {
            width: 4px; border-radius: 2px;
            background: linear-gradient(to top, var(--ob-blue-dark), var(--ob-blue-light));
            animation: waveAnim ease-in-out infinite;
        }
        @keyframes waveAnim {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }

        /* Floating tags */
        .hero-tags { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 1rem; }
        .hero-tag {
            display: inline-flex; align-items: center; gap: 5px;
            padding: 5px 12px; border-radius: 999px; font-size: 0.72rem; font-weight: 700;
            background: rgba(255,255,255,0.9); border: 1px solid var(--border);
            color: var(--text-secondary); animation: tagFloat ease-in-out infinite;
            box-shadow: 0 2px 8px rgba(50,181,229,0.08);
        }
        .hero-tag .tag-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--ob-blue); }
        @keyframes tagFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        /* ==================== MAIN ==================== */
        main { position: relative; z-index: 1; max-width: 880px; margin: 0 auto; padding: 2.5rem 1.5rem 6rem; }

        .section { display: none; }
        .section.active { display: block; }
        .section.active > * { animation: fadeSlideUp 0.55s cubic-bezier(0.22, 1, 0.36, 1) both; }
        .section.active > *:nth-child(1) { animation-delay: 0.00s; }
        .section.active > *:nth-child(2) { animation-delay: 0.07s; }
        .section.active > *:nth-child(3) { animation-delay: 0.14s; }
        .section.active > *:nth-child(4) { animation-delay: 0.21s; }
        .section.active > *:nth-child(5) { animation-delay: 0.28s; }
        .section.active > *:nth-child(6) { animation-delay: 0.35s; }
        @keyframes fadeSlideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }

        /* ==================== STEPS ==================== */
        .steps {
            display: flex; align-items: center; margin-bottom: 1.75rem;
            padding: 18px 22px; background: var(--surface);
            border-radius: var(--radius-xl); border: 1px solid var(--border);
            box-shadow: var(--shadow-sm), 0 0 0 4px rgba(50,181,229,0.03);
        }
        .step { display: flex; align-items: center; gap: 10px; }
        .step-num {
            width: 34px; height: 34px; border-radius: 50%; display: grid; place-items: center;
            font-size: 0.75rem; font-weight: 800; background: var(--bg); color: var(--text-muted);
            border: 2px solid var(--border); transition: all 0.45s cubic-bezier(0.22, 1, 0.36, 1); flex-shrink: 0;
        }
        .step.active .step-num {
            background: var(--ob-blue); color: white; border-color: var(--ob-blue);
            box-shadow: 0 0 0 4px rgba(50,181,229,0.2), 0 0 0 8px rgba(50,181,229,0.08);
            animation: stepPulse 2.5s ease-in-out infinite;
        }
        @keyframes stepPulse {
            0%, 100% { box-shadow: 0 0 0 4px rgba(50,181,229,0.2), 0 0 0 8px rgba(50,181,229,0.06); }
            50% { box-shadow: 0 0 0 6px rgba(50,181,229,0.15), 0 0 0 12px rgba(50,181,229,0.04); }
        }
        .step.done .step-num { background: var(--success); border-color: var(--success); color: white; animation: none; }
        .step-label { font-size: 0.8rem; color: var(--text-muted); font-weight: 700; transition: color 0.3s; letter-spacing: 0.02em; }
        .step.active .step-label { color: var(--ob-blue-dark); }
        .step.done .step-label { color: var(--success); }
        .step-line { flex: 1; height: 3px; background: var(--border); margin: 0 14px; border-radius: 2px; position: relative; overflow: hidden; }
        .step-line::after { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 0%; background: linear-gradient(90deg, var(--success), #34D399); border-radius: 2px; transition: width 0.7s cubic-bezier(0.22, 1, 0.36, 1); }
        .step-line.done::after { width: 100%; }

        /* ==================== CARDS ==================== */
        .card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius-xl); padding: 2rem; margin-bottom: 1.25rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.35s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative; overflow: hidden;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--ob-blue), var(--ob-blue-light), var(--ob-blue));
            background-size: 200% 100%; animation: cardTopShimmer 5s linear infinite; opacity: 0;
            transition: opacity 0.4s ease;
        }
        @keyframes cardTopShimmer { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
        .card:hover { box-shadow: var(--shadow-md), 0 0 0 1px rgba(50,181,229,0.12); border-color: rgba(50,181,229,0.25); transform: translateY(-2px); }
        .card:hover::before { opacity: 1; }

        .card-label {
            display: inline-flex; align-items: center; gap: 8px;
            font-size: 0.68rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.1em;
            color: var(--ob-blue); margin-bottom: 1.25rem;
            padding: 5px 14px; background: linear-gradient(135deg, var(--ob-blue-pale), rgba(50,181,229,0.05));
            border-radius: 999px; border: 1px solid rgba(50,181,229,0.2);
        }
        .card-label .dot {
            width: 7px; height: 7px; background: var(--ob-blue);
            border-radius: 50%; animation: dotBlink 1.8s ease-in-out infinite;
            box-shadow: 0 0 0 0 rgba(50,181,229,0.5);
        }
        @keyframes dotBlink {
            0%, 100% { box-shadow: 0 0 0 0 rgba(50,181,229,0.5); opacity: 1; }
            50% { box-shadow: 0 0 0 5px rgba(50,181,229,0); opacity: 0.7; }
        }

        /* ==================== UPLOAD ZONE ==================== */
        .upload-zone {
            border: 2px dashed var(--border-hover); border-radius: var(--radius-lg);
            padding: 3rem 2rem; text-align: center; cursor: pointer;
            transition: all 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative; overflow: hidden;
            background: linear-gradient(135deg, rgba(50,181,229,0.02), rgba(95,201,237,0.04));
        }
        .upload-zone::after {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at center, rgba(50,181,229,0.06) 0%, transparent 70%);
            opacity: 0; transition: opacity 0.4s;
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--ob-blue); border-style: solid;
            background: linear-gradient(135deg, rgba(50,181,229,0.05), rgba(95,201,237,0.08));
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(50,181,229,0.12), 0 0 0 4px rgba(50,181,229,0.08);
        }
        .upload-zone:hover::after, .upload-zone.dragover::after { opacity: 1; }

        /* Animated upload icon */
        .upload-icon {
            width: 72px; height: 72px; margin: 0 auto 1.2rem;
            border-radius: 20px; display: grid; place-items: center;
            background: linear-gradient(135deg, var(--ob-blue-pale), rgba(50,181,229,0.12));
            position: relative; transition: transform 0.4s cubic-bezier(0.22,1,0.36,1);
            box-shadow: 0 4px 20px rgba(50,181,229,0.15);
        }
        .upload-zone:hover .upload-icon { transform: translateY(-6px) scale(1.05); }
        .upload-icon svg { width: 30px; height: 30px; color: var(--ob-blue); position: relative; z-index: 1; }
        .upload-icon-ring {
            position: absolute; inset: -6px; border-radius: 26px;
            border: 2px dashed rgba(50,181,229,0.3);
            animation: iconRotate 15s linear infinite;
        }
        .upload-icon-ring-2 {
            position: absolute; inset: -14px; border-radius: 34px;
            border: 1px dashed rgba(50,181,229,0.15);
            animation: iconRotate 25s linear infinite reverse;
        }
        @keyframes iconRotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* Floating arrow animation */
        .upload-arrow {
            animation: arrowBounce 1.5s ease-in-out infinite;
            display: inline-block;
        }
        @keyframes arrowBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .upload-zone h3 { font-size: 1.05rem; font-weight: 800; color: var(--ob-charcoal); margin-bottom: 0.4rem; position: relative; z-index: 1; }
        .upload-zone p { font-size: 0.83rem; color: var(--text-muted); position: relative; z-index: 1; }
        .upload-zone input[type="file"] { display: none; }

        /* Format chips */
        .format-chips { display: flex; gap: 6px; justify-content: center; margin-top: 0.9rem; flex-wrap: wrap; position: relative; z-index: 1; }
        .format-chip {
            padding: 3px 10px; border-radius: 6px; font-size: 0.68rem; font-weight: 700;
            background: rgba(50,181,229,0.08); color: var(--ob-blue-deeper);
            border: 1px solid rgba(50,181,229,0.15); font-family: var(--font-mono);
            letter-spacing: 0.04em;
        }

        /* File list */
        .file-list { list-style: none; margin-top: 1.25rem; }
        .file-item {
            display: flex; align-items: center; gap: 12px; padding: 13px 16px;
            background: linear-gradient(135deg, rgba(240,248,255,0.8), rgba(255,255,255,0.9));
            border-radius: var(--radius); margin-bottom: 6px;
            border: 1px solid var(--border); font-size: 0.88rem; cursor: grab;
            transition: all 0.28s cubic-bezier(0.22, 1, 0.36, 1); user-select: none;
            animation: fileSlideIn 0.35s cubic-bezier(0.22, 1, 0.36, 1) both;
            position: relative; overflow: hidden;
        }
        .file-item::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px;
            background: linear-gradient(to bottom, var(--ob-blue), var(--ob-blue-light));
            border-radius: 0 2px 2px 0;
        }
        .file-item:active { cursor: grabbing; transform: scale(1.02) rotate(0.5deg); box-shadow: var(--shadow-md); z-index: 10; }
        .file-item:hover { border-color: var(--ob-blue); background: var(--ob-blue-pale); transform: translateX(4px); }
        .file-item.dragging { opacity: 0.25; transform: scale(0.97); }
        @keyframes fileSlideIn { from { opacity: 0; transform: translateX(-16px); } to { opacity: 1; transform: translateX(0); } }
        .file-item .drag-handle { color: var(--text-muted); flex-shrink: 0; }
        .file-item .file-icon {
            width: 34px; height: 34px; border-radius: 9px;
            background: linear-gradient(135deg, var(--ob-blue-pale), rgba(50,181,229,0.12));
            display: grid; place-items: center; flex-shrink: 0;
            border: 1px solid rgba(50,181,229,0.2);
        }
        .file-item .file-icon svg { width: 16px; height: 16px; color: var(--ob-blue); }
        .file-item .file-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 600; }
        .file-item .file-size { color: var(--text-muted); font-size: 0.73rem; font-family: var(--font-mono); background: rgba(50,181,229,0.06); padding: 3px 8px; border-radius: 6px; }
        .file-item .remove-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; padding: 6px; border-radius: 8px; transition: all 0.2s; display: grid; place-items: center; }
        .file-item .remove-btn:hover { color: var(--error); background: var(--error-light); transform: scale(1.1) rotate(90deg); }
        .file-count { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem; font-family: var(--font-mono); }
        .tip {
            font-size: 0.78rem; color: var(--ob-blue-deeper); margin-top: 0.85rem;
            display: flex; align-items: center; gap: 8px; padding: 10px 16px;
            background: linear-gradient(135deg, var(--ob-blue-pale), rgba(50,181,229,0.04));
            border-radius: var(--radius-sm); border: 1px solid rgba(50,181,229,0.2);
        }
        .tip svg { width: 14px; height: 14px; color: var(--ob-blue); flex-shrink: 0; }

        /* ==================== BUTTONS ==================== */
        .btn {
            font-family: var(--font); font-size: 0.88rem; font-weight: 800;
            padding: 15px 30px; border-radius: var(--radius); border: none; cursor: pointer;
            display: inline-flex; align-items: center; gap: 10px;
            transition: all 0.35s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative; overflow: hidden; letter-spacing: 0.01em;
        }
        .btn::after {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.18) 0%, transparent 60%);
            pointer-events: none; border-radius: inherit;
        }
        /* Ripple on click */
        .btn .ripple {
            position: absolute; border-radius: 50%;
            background: rgba(255,255,255,0.35); transform: scale(0);
            animation: rippleOut 0.6s linear; pointer-events: none;
        }
        @keyframes rippleOut { to { transform: scale(4); opacity: 0; } }

        .btn svg { width: 18px; height: 18px; flex-shrink: 0; }
        .btn-primary {
            background: linear-gradient(135deg, var(--ob-blue) 0%, var(--ob-blue-dark) 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(50,181,229,0.3), 0 1px 4px rgba(50,181,229,0.2);
        }
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 10px 40px rgba(50,181,229,0.45), 0 4px 12px rgba(50,181,229,0.25);
        }
        .btn-primary:active { transform: translateY(-1px); }
        .btn-primary:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; box-shadow: none; }
        .btn-secondary { background: var(--surface); color: var(--text); border: 1.5px solid var(--border); box-shadow: var(--shadow-sm); }
        .btn-secondary:hover { border-color: var(--ob-blue); color: var(--ob-blue); background: var(--ob-blue-pale); transform: translateY(-2px); }
        .btn-success { background: linear-gradient(135deg, var(--success), #059669); color: white; box-shadow: 0 4px 20px rgba(16,185,129,0.25); }
        .btn-success:hover { transform: translateY(-3px); box-shadow: 0 10px 36px rgba(16,185,129,0.35); }
        .btn-full { width: 100%; justify-content: center; }

        /* Animated CTA button */
        .btn-primary.btn-full {
            background: linear-gradient(135deg, #32B5E5 0%, #2196C7 50%, #1A7BA3 100%);
            background-size: 200% 200%;
            animation: btnGradient 4s ease infinite;
        }
        .btn-primary.btn-full:not(:disabled):hover { animation-play-state: paused; }
        @keyframes btnGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .spinner { width: 18px; height: 18px; border: 2.5px solid rgba(50,181,229,0.2); border-top-color: var(--ob-blue); border-radius: 50%; animation: spin 0.7s linear infinite; flex-shrink: 0; }
        .spinner.white { border-color: rgba(255,255,255,0.3); border-top-color: white; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ==================== PROGRESS ==================== */
        .progress-bar { width: 100%; height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; margin: 1rem 0; }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, var(--ob-blue-dark), var(--ob-blue), var(--ob-blue-light));
            border-radius: 3px; transition: width 0.6s ease; width: 0%; position: relative;
        }
        .progress-fill::after { content: ''; position: absolute; inset: 0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent); animation: shimmer 1.2s infinite; }
        @keyframes shimmer { from { transform: translateX(-100%); } to { transform: translateX(100%); } }
        .progress-fill.indeterminate { width: 35%; animation: indeterminate 1.8s cubic-bezier(0.4, 0, 0.2, 1) infinite; }
        @keyframes indeterminate { 0% { transform: translateX(-100%); } 100% { transform: translateX(320%); } }

        /* ==================== STATUS MESSAGES ==================== */
        .status-msg {
            padding: 15px 20px; border-radius: var(--radius); font-size: 0.85rem;
            display: flex; align-items: center; gap: 12px; margin-top: 0.75rem;
            line-height: 1.5; font-weight: 600; animation: fadeSlideUp 0.35s ease;
        }
        .status-msg svg { width: 18px; height: 18px; flex-shrink: 0; }
        .status-msg.error { background: var(--error-light); border: 1px solid rgba(239,68,68,0.25); color: var(--error); }
        .status-msg.success { background: var(--success-light); border: 1px solid rgba(16,185,129,0.25); color: #065F46; }
        .status-msg.info { background: linear-gradient(135deg, var(--ob-blue-pale), rgba(50,181,229,0.04)); border: 1px solid var(--border-blue); color: var(--ob-blue-deeper); }

        /* ==================== RESULTS ==================== */
        .result-panel {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: var(--radius-xl); overflow: hidden; margin-top: 1.25rem;
            box-shadow: var(--shadow-md), 0 0 0 1px rgba(50,181,229,0.08);
            animation: scaleIn 0.45s cubic-bezier(0.22, 1, 0.36, 1);
        }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.96) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .result-header {
            display: flex; align-items: center; justify-content: space-between; padding: 18px 22px;
            background: linear-gradient(135deg, rgba(50,181,229,0.06), rgba(50,181,229,0.02));
            border-bottom: 1px solid var(--border);
        }
        .result-header span { font-size: 0.85rem; font-weight: 800; color: var(--ob-charcoal); }
        .result-body {
            padding: 22px; max-height: 380px; overflow-y: auto;
            font-family: var(--font-mono); font-size: 0.74rem; line-height: 1.9;
            color: var(--text-secondary); white-space: pre-wrap; word-break: break-word; background: #F8FBFF;
        }
        .result-body::-webkit-scrollbar { width: 5px; }
        .result-body::-webkit-scrollbar-track { background: transparent; }
        .result-body::-webkit-scrollbar-thumb { background: rgba(50,181,229,0.3); border-radius: 3px; }
        .result-actions { display: flex; gap: 8px; padding: 16px 20px; border-top: 1px solid var(--border); flex-wrap: wrap; background: rgba(240,248,255,0.4); }
        .result-actions .btn { font-size: 0.8rem; padding: 10px 20px; }

        /* ==================== TIMELINE INPUTS ==================== */
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media (max-width: 640px) { .input-row { grid-template-columns: 1fr; } }

        .file-input-card {
            background: linear-gradient(135deg, rgba(240,248,255,0.8), rgba(255,255,255,0.9));
            border: 2px dashed var(--border-hover); border-radius: var(--radius-lg);
            padding: 2rem 1.5rem; text-align: center; cursor: pointer;
            transition: all 0.35s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative; overflow: hidden;
        }
        .file-input-card::before {
            content: ''; position: absolute; inset: 0;
            background: radial-gradient(ellipse at 50% 0%, rgba(50,181,229,0.08), transparent 70%);
            opacity: 0; transition: opacity 0.4s;
        }
        .file-input-card:hover { border-color: var(--ob-blue); border-style: solid; background: var(--ob-blue-pale); transform: translateY(-4px); box-shadow: var(--shadow-blue); }
        .file-input-card:hover::before { opacity: 1; }
        .file-input-card.has-file { border-color: var(--success); border-style: solid; background: var(--success-light); }
        .file-input-card.has-file:hover { border-color: var(--success); transform: translateY(-3px); }
        .file-input-card input { display: none; }
        .file-input-card .fic-icon {
            width: 54px; height: 54px; border-radius: 15px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), var(--ob-blue-pale));
            display: grid; place-items: center; margin: 0 auto 14px;
            transition: all 0.4s cubic-bezier(0.22,1,0.36,1);
            border: 1.5px solid rgba(50,181,229,0.2);
            box-shadow: 0 2px 12px rgba(50,181,229,0.1);
        }
        .file-input-card:hover .fic-icon { transform: scale(1.1) translateY(-3px); box-shadow: 0 8px 24px rgba(50,181,229,0.2); }
        .file-input-card .fic-icon svg { width: 22px; height: 22px; color: var(--ob-blue); }
        .file-input-card.has-file .fic-icon { background: var(--success); border-color: var(--success); box-shadow: 0 4px 16px rgba(16,185,129,0.3); }
        .file-input-card.has-file .fic-icon svg { color: white; }
        .file-input-card h4 { font-size: 0.9rem; font-weight: 800; margin-bottom: 4px; color: var(--ob-charcoal); }
        .file-input-card p { font-size: 0.76rem; color: var(--text-muted); }
        .file-input-card .selected-file { margin-top: 12px; font-size: 0.74rem; color: var(--success); font-family: var(--font-mono); font-weight: 700; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        .badge { display: inline-flex; align-items: center; gap: 5px; padding: 4px 12px; border-radius: 999px; font-size: 0.72rem; font-weight: 800; font-family: var(--font-mono); }
        .badge-success { background: var(--success-light); color: #065F46; border: 1px solid rgba(16,185,129,0.2); }

        /* ==================== FOOTER ==================== */
        footer {
            position: relative; z-index: 1; text-align: center; padding: 2.5rem 2rem;
            color: var(--text-muted); font-size: 0.78rem;
            border-top: 1px solid rgba(50,181,229,0.12);
            background: linear-gradient(to bottom, transparent, rgba(50,181,229,0.03));
        }
        footer a { color: var(--ob-blue); text-decoration: none; font-weight: 700; }
        footer a:hover { text-decoration: underline; }
        .footer-wave { position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--ob-blue), var(--ob-blue-light), var(--ob-blue), transparent); }

        /* ==================== MEDIA QUERIES ==================== */
        @media (max-width: 640px) {
            main { padding: 1.5rem 1rem 4rem; }
            .hero-text h1 { font-size: 1.7rem; }
            .header-inner { flex-direction: column; height: auto; padding: 14px 0; gap: 12px; }
            .steps { flex-wrap: wrap; gap: 6px; padding: 14px 16px; }
            .step-line { display: none; }
            .card { padding: 1.5rem; }
            .nav-tabs { width: 100%; }
            .nav-tab { flex: 1; text-align: center; padding: 10px 12px; }
            .hero-banner { padding: 1.5rem 1rem 1.2rem; }
            .hero-wave { display: none; }
        }
    </style>
</head>
<body>
    <!-- Background layers -->
    <div class="bg-canvas">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
    </div>
    <div class="dot-grid"></div>
    <div class="particles" id="particles"></div>

    <!-- Header -->
    <header>
        <div class="header-inner">
            <a class="logo" href="#">
                <div class="logo-img-wrap">
                    <img src="/static/LOGO.png" alt="Oliveboard" onerror="this.style.display='none'">
                </div>
                <div class="logo-divider"></div>
                <div class="logo-text-wrap">
                    <span class="logo-subtitle">Audio Transcriber</span>
                    <span class="logo-tagline">Powered by Gemini AI</span>
                </div>
            </a>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('transcribe', this)">ðŸŽ™&nbsp; Transcribe</button>
                <button class="nav-tab" onclick="switchTab('timeline', this)">ðŸŽ¬&nbsp; Timeline Planner</button>
            </div>
        </div>
    </header>
    <div class="status-bar"></div>

    <!-- Hero banner -->
    <div class="hero-banner" id="hero-banner">
        <div class="hero-inner">
            <div class="hero-text">
                <h1>Turn <span class="word-audio">Audio</span> into<br>Timelines â€” Fast</h1>
                <p>Upload audio files, get word-level timestamps with Gemini AI, and auto-generate a DaVinci Resolve timeline in seconds.</p>
                <div class="hero-tags">
                    <span class="hero-tag" style="animation-duration:3.2s"><span class="tag-dot"></span>MP3 / WAV / FLAC</span>
                    <span class="hero-tag" style="animation-duration:2.8s; animation-delay:0.2s"><span class="tag-dot"></span>Gemini AI</span>
                    <span class="hero-tag" style="animation-duration:3.5s; animation-delay:0.4s"><span class="tag-dot"></span>DaVinci Resolve</span>
                    <span class="hero-tag" style="animation-duration:2.6s; animation-delay:0.6s"><span class="tag-dot"></span>Word Timestamps</span>
                </div>
            </div>
            <div class="hero-wave" id="hero-wave">
                <!-- Bars generated by JS -->
            </div>
        </div>
    </div>

    <main>
        <!-- TAB 1: TRANSCRIBE -->
        <div class="section active" id="section-transcribe">
            <div class="steps">
                <div class="step active" id="step-1"><div class="step-num">1</div><span class="step-label">Upload</span></div>
                <div class="step-line" id="line-1"></div>
                <div class="step active" id="step-2"><div class="step-num">2</div><span class="step-label">Reorder</span></div>
                <div class="step-line" id="line-2"></div>
                <div class="step" id="step-3"><div class="step-num">3</div><span class="step-label">Process</span></div>
                <div class="step-line" id="line-3"></div>
                <div class="step" id="step-4"><div class="step-num">4</div><span class="step-label">Result</span></div>
            </div>

            <div class="card" id="upload-card">
                <div class="card-label"><span class="dot"></span> Audio Files</div>
                <div class="upload-zone" id="upload-zone" onclick="document.getElementById('audio-input').click()">
                    <div class="upload-icon">
                        <div class="upload-icon-ring"></div>
                        <div class="upload-icon-ring-2"></div>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <h3>Drop audio files here</h3>
                    <p>or click to browse your files</p>
                    <div class="format-chips">
                        <span class="format-chip">MP3</span>
                        <span class="format-chip">WAV</span>
                        <span class="format-chip">M4A</span>
                        <span class="format-chip">OGG</span>
                        <span class="format-chip">FLAC</span>
                    </div>
                    <input type="file" id="audio-input" multiple accept=".mp3,.wav,.m4a,.ogg,.webm,.flac">
                </div>
                <ul class="file-list" id="file-list"></ul>
                <div class="file-count" id="file-count"></div>
                <div class="tip" id="reorder-tip" style="display:none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M7 15l5 5 5-5M7 9l5-5 5 5"/></svg>
                    <span>Drag to reorder files. The final merge follows this sequence.</span>
                </div>
            </div>

            <button class="btn btn-primary btn-full" id="process-btn" onclick="processAudio()" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                Merge &amp; Transcribe
            </button>

            <div id="process-status" style="display:none;">
                <div class="progress-bar"><div class="progress-fill indeterminate" id="process-progress"></div></div>
                <div class="status-msg info" id="process-msg"><div class="spinner"></div><span>Processing audio filesâ€¦</span></div>
            </div>

            <div id="transcribe-result" style="display:none;">
                <div class="result-panel">
                    <div class="result-header">
                        <span>ðŸ“„ Transcription Output</span>
                        <span class="badge badge-success" id="word-count-badge"></span>
                    </div>
                    <div class="result-body" id="transcription-text"></div>
                    <div class="result-actions">
                        <button class="btn btn-secondary" onclick="downloadTranscription()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Download JSON
                        </button>
                        <button class="btn btn-secondary" onclick="downloadAudio()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
                            Merged Audio
                        </button>
                        <button class="btn btn-success" onclick="useInTimeline()">Use in Timeline â†’</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: TIMELINE PLANNER -->
        <div class="section" id="section-timeline">
            <div class="card">
                <div class="card-label"><span class="dot"></span> Inputs</div>
                <div id="current-transcription-notice" style="display:none; margin-bottom: 1rem;">
                    <button class="btn btn-success btn-full" onclick="useCurrentTranscription()" id="use-current-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                        Use current transcription result
                    </button>
                </div>
                <div class="input-row">
                    <div class="file-input-card" id="json-card" onclick="document.getElementById('json-input').click()">
                        <input type="file" id="json-input" accept=".json" onchange="handleTimelineFile(this, 'json-card', 'json-name')">
                        <div class="fic-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                        </div>
                        <h4>Transcription JSON</h4>
                        <p>from /process/ output</p>
                        <div class="selected-file" id="json-name"></div>
                    </div>
                    <div class="file-input-card" id="doc-card" onclick="document.getElementById('doc-input').click()">
                        <input type="file" id="doc-input" accept=".pdf,.docx,.doc" onchange="handleTimelineFile(this, 'doc-card', 'doc-name')">
                        <div class="fic-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                        </div>
                        <h4>Slide Script</h4>
                        <p>.pdf or .docx</p>
                        <div class="selected-file" id="doc-name"></div>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary btn-full" id="timeline-btn" onclick="generateTimeline()" disabled>
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><polyline points="16 2 12 7 8 2"/></svg>
                Generate master_plan.json
            </button>

            <div id="timeline-status" style="display:none;">
                <div class="progress-bar"><div class="progress-fill indeterminate" id="timeline-progress"></div></div>
                <div class="status-msg info" id="timeline-msg"><div class="spinner"></div><span>Generating timeline with Geminiâ€¦</span></div>
            </div>

            <div id="timeline-result" style="display:none;">
                <div class="result-panel">
                    <div class="result-header">
                        <span>ðŸŽ¬ master_plan.json</span>
                        <span class="badge badge-success" id="clip-count-badge"></span>
                    </div>
                    <div class="result-body" id="timeline-output"></div>
                    <div class="result-actions">
                        <button class="btn btn-success" id="download-timeline-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            Download master_plan.json
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="footer-wave"></div>
        Built for <a href="#">Oliveboard</a> â€” Audio to DaVinci Resolve Timeline &nbsp;Â·&nbsp; Powered by <a href="#">Gemini AI</a>
    </footer>

    <script>
        // ==================== PARTICLES ====================
        (function spawnParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 18; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                const size = Math.random() * 5 + 2;
                p.style.cssText = `
                    width: ${size}px; height: ${size}px;
                    left: ${Math.random() * 100}%;
                    bottom: 0;
                    animation-delay: ${Math.random() * 20}s;
                    animation-duration: ${Math.random() * 15 + 12}s;
                    opacity: 0;
                    background: ${Math.random() > 0.5 ? '#32B5E5' : '#5FC9ED'};
                    filter: blur(${size > 5 ? 1 : 0}px);
                `;
                container.appendChild(p);
            }
        })();

        // ==================== WAVE BARS ====================
        (function buildWave() {
            const waveEl = document.getElementById('hero-wave');
            const barCount = 28;
            for (let i = 0; i < barCount; i++) {
                const bar = document.createElement('div');
                bar.className = 'wave-bar';
                const minH = 8, maxH = 48;
                const h = Math.random() * (maxH - minH) + minH;
                const delay = (i / barCount) * -2;
                const dur = 0.6 + Math.random() * 1.2;
                bar.style.cssText = `height: ${h}px; animation-duration: ${dur}s; animation-delay: ${delay}s;`;
                waveEl.appendChild(bar);
            }
        })();

        // ==================== BUTTON RIPPLE ====================
        document.querySelectorAll('.btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                const r = document.createElement('span');
                r.className = 'ripple';
                const rect = btn.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                r.style.width = r.style.height = size + 'px';
                r.style.left = (e.clientX - rect.left - size/2) + 'px';
                r.style.top = (e.clientY - rect.top - size/2) + 'px';
                btn.appendChild(r);
                setTimeout(() => r.remove(), 700);
            });
        });

        // ==================== APP STATE ====================
        let uploadedFiles = [];
        let transcriptionData = null;
        let mergedAudioUrl = null;
        let timelineJsonFile = null;

        // ==================== TAB SWITCHING ====================
        function switchTab(tab, clickedBtn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`section-${tab}`).classList.add('active');
            if (clickedBtn) clickedBtn.classList.add('active');
            // Show/hide hero for timeline tab
            document.getElementById('hero-banner').style.display = tab === 'timeline' ? 'none' : '';
        }
        function switchTabDirect(tab) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`section-${tab}`).classList.add('active');
            const idx = tab === 'timeline' ? 1 : 0;
            document.querySelectorAll('.nav-tab')[idx].classList.add('active');
            document.getElementById('hero-banner').style.display = tab === 'timeline' ? 'none' : '';
        }

        // ==================== FILE UPLOAD ====================
        const uploadZone = document.getElementById('upload-zone');
        const audioInput = document.getElementById('audio-input');
        ['dragenter', 'dragover'].forEach(evt => uploadZone.addEventListener(evt, e => { e.preventDefault(); uploadZone.classList.add('dragover'); }));
        ['dragleave', 'drop'].forEach(evt => uploadZone.addEventListener(evt, e => { e.preventDefault(); uploadZone.classList.remove('dragover'); }));
        uploadZone.addEventListener('drop', e => {
            addFiles([...e.dataTransfer.files].filter(f => /audio|\.mp3|\.wav|\.m4a|\.ogg|\.webm|\.flac/i.test(f.type || f.name)));
        });
        audioInput.addEventListener('change', () => { addFiles([...audioInput.files]); audioInput.value = ''; });

        function addFiles(files) {
            files.forEach(f => { if (!uploadedFiles.find(u => u.name === f.name && u.size === f.size)) uploadedFiles.push(f); });
            renderFileList();
        }
        function removeFile(i) { uploadedFiles.splice(i, 1); renderFileList(); }

        function renderFileList() {
            const list = document.getElementById('file-list'), count = document.getElementById('file-count');
            const tip = document.getElementById('reorder-tip'), btn = document.getElementById('process-btn');
            if (!uploadedFiles.length) { list.innerHTML = ''; count.textContent = ''; tip.style.display = 'none'; btn.disabled = true; return; }
            tip.style.display = 'flex'; btn.disabled = false;
            count.textContent = `${uploadedFiles.length} file${uploadedFiles.length > 1 ? 's' : ''} selected`;
            list.innerHTML = uploadedFiles.map((f, i) => `
                <li class="file-item" draggable="true" data-index="${i}" style="animation-delay:${i*0.05}s"
                    ondragstart="onDragStart(event)" ondragover="onDragOver(event)" ondrop="onDrop(event)" ondragend="onDragEnd(event)">
                    <span class="drag-handle"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="9" cy="6" r="1"/><circle cx="15" cy="6" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="9" cy="18" r="1"/><circle cx="15" cy="18" r="1"/></svg></span>
                    <span class="file-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></span>
                    <span class="file-name">${f.name}</span>
                    <span class="file-size">${fmtSize(f.size)}</span>
                    <button class="remove-btn" onclick="event.stopPropagation();removeFile(${i})"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </li>`).join('');
        }
        function fmtSize(b) { return b < 1024 ? b+' B' : b < 1048576 ? (b/1024).toFixed(1)+' KB' : (b/1048576).toFixed(1)+' MB'; }

        let dragIndex = null;
        function onDragStart(e) { dragIndex = +e.currentTarget.dataset.index; e.currentTarget.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; }
        function onDragOver(e) { e.preventDefault(); }
        function onDrop(e) {
            e.preventDefault(); const t = +e.currentTarget.dataset.index;
            if (dragIndex !== null && dragIndex !== t) { const [m] = uploadedFiles.splice(dragIndex, 1); uploadedFiles.splice(t, 0, m); renderFileList(); }
        }
        function onDragEnd(e) { e.currentTarget.classList.remove('dragging'); dragIndex = null; }

        // ==================== PROCESS AUDIO ====================
        async function processAudio() {
            const btn = document.getElementById('process-btn'), status = document.getElementById('process-status');
            const msg = document.getElementById('process-msg'), result = document.getElementById('transcribe-result');
            btn.disabled = true; btn.innerHTML = '<div class="spinner white"></div> Processingâ€¦';
            status.style.display = 'block'; result.style.display = 'none';
            setStep(3, 'active'); setStep(4, '');
            const fd = new FormData();
            uploadedFiles.forEach(f => fd.append('files', f));
            fd.append('file_order', uploadedFiles.map(f => f.name).join(','));
            try {
                msg.innerHTML = '<div class="spinner"></div><span>Uploading and merging audio filesâ€¦</span>'; msg.className = 'status-msg info';
                const resp = await fetch('/process/', { method: 'POST', body: fd }), data = await resp.json();
                if (data.status === 'success') {
                    transcriptionData = data.transcription; mergedAudioUrl = data.merged_audio_url;
                    setStep(3, 'done'); setStep(4, 'done');
                    document.getElementById('line-2').classList.add('done'); document.getElementById('line-3').classList.add('done');
                    document.getElementById('word-count-badge').textContent = `${(data.transcription.words||[]).length} words`;
                    document.getElementById('transcription-text').textContent = JSON.stringify(data.transcription, null, 2);
                    status.style.display = 'none'; result.style.display = 'block';
                    document.getElementById('current-transcription-notice').style.display = 'block';
                    btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Done!`; btn.disabled = false;
                    setTimeout(() => { btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg> Merge & Transcribe`; }, 2500);
                } else throw new Error(data.message || 'Processing failed');
            } catch (err) {
                msg.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg><span>${err.message}</span>`;
                msg.className = 'status-msg error'; btn.disabled = false;
                btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg> Merge & Transcribe`;
            }
        }

        function setStep(n, s) { const el = document.getElementById(`step-${n}`); if (!el) return; el.classList.remove('active','done'); if (s) el.classList.add(s); }
        function downloadTranscription() { if (!transcriptionData) return; const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(transcriptionData,null,2)],{type:'application/json'})); a.download = 'transcription.json'; a.click(); }
        function downloadAudio() { if (mergedAudioUrl) window.open(mergedAudioUrl, '_blank'); }
        function useInTimeline() { switchTabDirect('timeline'); useCurrentTranscription(); }

        // ==================== TIMELINE ====================
        function handleTimelineFile(input, cardId, nameId) {
            const c = document.getElementById(cardId), n = document.getElementById(nameId);
            if (input.files.length) { c.classList.add('has-file'); n.textContent = 'âœ“ ' + input.files[0].name; }
            else { c.classList.remove('has-file'); n.textContent = ''; }
            checkTimelineReady();
        }
        function useCurrentTranscription() {
            if (!transcriptionData) return;
            timelineJsonFile = new File([new Blob([JSON.stringify(transcriptionData,null,2)],{type:'application/json'})], 'transcription.json', {type:'application/json'});
            document.getElementById('json-card').classList.add('has-file');
            document.getElementById('json-name').textContent = 'âœ“ Current transcription loaded';
            checkTimelineReady();
        }
        function checkTimelineReady() {
            const j = timelineJsonFile || document.getElementById('json-input').files.length > 0;
            const d = document.getElementById('doc-input').files.length > 0;
            document.getElementById('timeline-btn').disabled = !(j && d);
        }
        async function generateTimeline() {
            const btn = document.getElementById('timeline-btn'), status = document.getElementById('timeline-status');
            const msg = document.getElementById('timeline-msg'), result = document.getElementById('timeline-result');
            btn.disabled = true; btn.innerHTML = '<div class="spinner white"></div> Generatingâ€¦';
            status.style.display = 'block'; result.style.display = 'none';
            const fd = new FormData();
            fd.append('transcription_json', timelineJsonFile || document.getElementById('json-input').files[0]);
            fd.append('slide_doc', document.getElementById('doc-input').files[0]);
            try {
                msg.innerHTML = '<div class="spinner"></div><span>Sending to Gemini â€” this may take a minuteâ€¦</span>'; msg.className = 'status-msg info';
                const resp = await fetch('/generate-timeline/', { method: 'POST', body: fd }), data = await resp.json();
                if (data.status === 'success') {
                    document.getElementById('clip-count-badge').textContent = `${data.clip_count} clips`;
                    document.getElementById('timeline-output').textContent = JSON.stringify(data.plan, null, 2);
                    document.getElementById('download-timeline-btn').onclick = () => window.open(data.download_url, '_blank');
                    status.style.display = 'none'; result.style.display = 'block';
                    btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Done!`;
                    setTimeout(() => { btn.disabled = false; btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><polyline points="16 2 12 7 8 2"/></svg> Generate master_plan.json`; }, 2500);
                } else throw new Error(data.message || 'Failed');
            } catch (err) {
                msg.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg><span>${err.message}</span>`;
                msg.className = 'status-msg error'; btn.disabled = false;
                btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><polyline points="16 2 12 7 8 2"/></svg> Generate master_plan.json`;
            }
        }
    </script>
</body>
</html>